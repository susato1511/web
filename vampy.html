<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Garlic Survivor</title>

<!-- âœ… Prevent mobile zoom -->
<meta name="viewport"
      content="width=device-width,height=device-height,initial-scale=1.0,maximum-scale=1.0,user-scalable=no,viewport-fit=cover">

<link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='32' height='32'%3E%3Ctext x='0' y='32' font-size='32'%3EðŸ§›%3C/text%3E%3C/svg%3E">

<style>
* {
    -webkit-user-select: none;
    -webkit-touch-callout: none;
    user-select: none;
}

body {
    margin: 0;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    background: #000;

    touch-action: none;
    overscroll-behavior: none;
}

canvas {
    border: 1px solid #500;
    background: #200;

    touch-action: manipulation;
}


#score {
    position: absolute;
    top: 20px;
    color: #FFF;
    font-family: Arial;
    font-size: 24px;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
}
</style>
</head>

<body>
<div id="score">0</div>
<canvas id="game" width="300" height="600"></canvas>

<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
const scoreElement = document.getElementById('score');

/* ================== GAME STATE ================== */
const vampire = {
    x: 150,
    y: 500,
    size: 40,
    speed: 6,
    direction: 1
};

let garlics = [];
let score = 0;
let gameOver = false;
let gameStarted = false;

/* ================== PATTERN ================== */
function createCarpetPattern() {
    const p = document.createElement('canvas');
    p.width = p.height = 32;
    const c = p.getContext('2d');

    c.fillStyle = '#400000';
    c.fillRect(0,0,32,32);

    c.strokeStyle = '#daa52030';
    c.lineWidth = 2;
    c.beginPath();
    c.moveTo(0,0);
    c.lineTo(32,32);
    c.moveTo(16,0);
    c.lineTo(32,16);
    c.stroke();

    return ctx.createPattern(p,'repeat');
}
const carpetPattern = createCarpetPattern();

/* ================== INPUT (NO ZOOM) ================== */
function handleInput(e) {
    e.preventDefault();

    if (!gameStarted) {
        gameStarted = true;
        gameLoop();
        return;
    }

    if (!gameOver) {
        vampire.direction *= -1;
    } else {
        resetGame();
    }
}

canvas.addEventListener('touchstart', handleInput, { passive: false });
canvas.addEventListener('click', handleInput);

/* ================== GAME LOGIC ================== */
function resetGame() {
    vampire.x = 150;
    garlics = [];
    score = 0;
    gameOver = false;
    scoreElement.textContent = '0';
    gameLoop();
}

function createGarlic() {
    garlics.push({
        x: Math.random() * (canvas.width - 30),
        y: -30,
        size: 30,
        speed: 4 + Math.random() * 3,
        rotation: 0,
        rotateSpeed: (Math.random() - 0.5) * 0.1
    });
}

function update() {
    if (!gameStarted || gameOver) return;

    vampire.x += vampire.speed * vampire.direction;
    if (vampire.x < 0) vampire.x = canvas.width;
    if (vampire.x > canvas.width) vampire.x = 0;

    if (Math.random() < 0.04) createGarlic();

    for (let i = garlics.length - 1; i >= 0; i--) {
        const g = garlics[i];
        g.y += g.speed;
        g.rotation += g.rotateSpeed;

        const dx = vampire.x - g.x;
        const dy = vampire.y - g.y;
        if (Math.hypot(dx,dy) < vampire.size/2 + g.size/2) {
            gameOver = true;
        }

        if (g.y > canvas.height + 30) {
            garlics.splice(i,1);
            score++;
            scoreElement.textContent = score;
        }
    }
}

/* ================== DRAW ================== */
function draw() {
    const bg = ctx.createLinearGradient(0,0,0,canvas.height);
    bg.addColorStop(0,'#300000');
    bg.addColorStop(1,'#000');
    ctx.fillStyle = bg;
    ctx.fillRect(0,0,canvas.width,canvas.height);

    ctx.fillStyle = carpetPattern;
    ctx.fillRect(canvas.width/4,0,canvas.width/2,canvas.height);

    ctx.font = vampire.size+'px Arial';
    ctx.textAlign='center';
    ctx.textBaseline='middle';
    ctx.fillStyle='#8B0000';
    ctx.fillText('ðŸ§›', vampire.x, vampire.y);

    garlics.forEach(g=>{
        ctx.save();
        ctx.translate(g.x,g.y);
        ctx.rotate(g.rotation);
        ctx.font=g.size+'px Arial';
        ctx.fillText('ðŸ§„',0,0);
        ctx.restore();
    });

    ctx.fillStyle='#FFF';
    ctx.textAlign='center';
    if (!gameStarted) {
        ctx.font='24px Arial';
        ctx.fillText('Tap to Start',canvas.width/2,canvas.height/2);
        ctx.font='16px Arial';
        ctx.fillText('Tap to change direction',canvas.width/2,canvas.height/2+40);
    }
    if (gameOver) {
        ctx.font='32px Arial';
        ctx.fillText('Game Over!',canvas.width/2,canvas.height/2);
        ctx.font='18px Arial';
        ctx.fillText('Tap to restart',canvas.width/2,canvas.height/2+40);
    }
}

/* ================== LOOP ================== */
function gameLoop() {
    if (gameOver) return;
    update();
    draw();
    requestAnimationFrame(gameLoop);
}

draw();
</script>
</body>
</html>
